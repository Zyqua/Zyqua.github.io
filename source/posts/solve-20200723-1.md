title: 题解
date: 2020-07-23
weight: 20200723
<!--more-->
如果知道每个点的权值，可以直接树形$\texttt{DP}$求得最大点权和，复杂度$O(nk)$。

求一个点的权值，可以以这个点为根$\texttt{DFS}$，复杂度是$O(n)$的，如果每个点都这样求复杂度为$O(n^2)$，不行。可以用另一种方法，先以某个点为根求出到其他点的距离和相同最远距离数量，然后换根，以当前根节点的答案推出子节点的答案并递归下去，再回溯回来，这样的换根操作一共需要做$2(n-1)$次，是$O(n)$的，如果能以$O(n)$以下复杂度完成换根操作，则求权值的总复杂度低于$O(n^2)$，可以获得比暴力更优的复杂度。

首先考虑朴素的换根做法，从根节点向某个子节点走，那么子节点对应的子树的距离都减一，其他节点都加一，然后直接遍历所有节点并加减距离，复杂度$O(n)$。

以任意节点为根，做一遍$\texttt{DFS}$，给每个节点标上$\texttt{DFS}$序。我们知道一个子树内的节点的$\texttt{DFS}$序是一个连续的区间，那么可以直接用线段树维护当前节点到其他节点的距离和相同最远距离数量，每次换根复杂度$O(\log_2n)$。求权值的复杂度为$O(n\log_2 n)$，总复杂度$O(nk+n\log_2n)，$可以通过本题。